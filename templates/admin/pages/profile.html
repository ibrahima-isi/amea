<div class="row mb-4">
  <div class="col">
    <h1 class="h3">Profil Administrateur</h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="dashboard.php">Tableau de bord</a></li>
        <li class="breadcrumb-item active" aria-current="page">Profil</li>
      </ol>
    </nav>
  </div>
  <div class="col-12"></div>
</div>

{{error_block}}
{{success_block}}

<div class="row">
  <div class="col-md-4 mb-4">
    <div class="card shadow">
      <div class="card-header">
        <h5 class="m-0 font-weight-bold">Informations du compte</h5>
      </div>
      <div class="card-body">
        <div class="text-center mb-4">
          <div class="avatar-placeholder rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center avatar-lg">
            {{avatar_initials}}
          </div>
          <h4 class="font-weight-bold">{{display_name}}</h4>
          <p class="mb-1 text-muted">Utilisateur: <strong>{{username}}</strong></p>
          <span class="badge bg-primary">Rôle: {{role}}</span>
        </div>
        <hr>
        <p class="mb-2"><i class="fas fa-envelope me-2"></i> {{email}}</p>
      </div>
    </div>
  </div>

  <div class="col-md-8 mb-4">
    <div class="card shadow mb-4">
      <div class="card-header">
        <h5 class="m-0 font-weight-bold">Mettre à jour le profil</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="{{form_action}}">
          <input type="hidden" name="csrf_token" value="{{csrf_token}}">
          <input type="hidden" name="update_profile" value="1">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="nom" class="form-label">Nom</label>
              <input type="text" class="form-control" id="nom" name="nom" value="{{nom}}" required>
            </div>
            <div class="col-md-6">
              <label for="prenom" class="form-label">Prénom</label>
              <input type="text" class="form-control" id="prenom" name="prenom" value="{{prenom}}" required>
            </div>
            <div class="col-md-12">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email" value="{{email}}" required>
            </div>
          </div>
          <div class="mt-3 text-end">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow">
      <div class="card-header">
        <h5 class="m-0 font-weight-bold">Changer le mot de passe</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="{{form_action}}" id="passwordForm">
          <input type="hidden" name="csrf_token" value="{{csrf_token}}">
          <input type="hidden" name="change_password" value="1">
          <div class="mb-3">
            <label for="current_password" class="form-label">Mot de passe actuel</label>
            <input type="password" class="form-control" id="current_password" name="current_password" required>
          </div>
          <div class="mb-3">
            <label for="new_password" class="form-label">Nouveau mot de passe</label>
            <input type="password" class="form-control" id="new_password" name="new_password" required>
            <div class="form-text text-muted">Le mot de passe doit contenir au moins 8 caractères.</div>
          </div>
          <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirmer le nouveau mot de passe</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
          </div>
          <button type="submit" class="btn btn-primary"><i class="fas fa-key"></i> Changer le mot de passe</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('passwordForm')?.addEventListener('submit', function(e) {
    var newPassword = document.getElementById('new_password').value;
    var confirmPassword = document.getElementById('confirm_password').value;
    if (newPassword != confirmPassword) {
      e.preventDefault(); alert('Les mots de passe ne correspondent pas.');
    }
    if (newPassword.length < 8) {
      e.preventDefault(); alert('Le mot de passe doit contenir au moins 8 caractères.');
    }
  });
</script>
